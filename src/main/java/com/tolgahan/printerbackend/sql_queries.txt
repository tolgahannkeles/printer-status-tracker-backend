DROP TRIGGER IF EXISTS dailyUsageTrigger;
DELIMITER //

CREATE TRIGGER dailyUsageTrigger
BEFORE INSERT ON usages
FOR EACH ROW
BEGIN
    DECLARE latestTotalPages INT;

    -- En son tarihteki totalPages değerini almak için
    SELECT totalPages
    INTO latestTotalPages
    FROM usages
    WHERE date = (SELECT MAX(date) FROM usages where printerId=NEW.printerId)
    LIMIT 1;

    -- dailyUsage hesapla
    SET NEW.dailyUsage = NEW.totalPages - IFNULL(latestTotalPages, 0);
END;
//

DELIMITER ;